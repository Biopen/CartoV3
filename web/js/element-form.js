function encodeOptionValuesIntoHiddenInput(){var e=[];$(".option-field:visible").each(function(){var t={};t.id=$(this).attr("data-id"),t.index=$(this).attr("data-index"),t.description=$(this).find(".option-field-description-input[data-id="+t.id+"]").val()||"",e.push(t)}),console.log("encodeOptionValues",e),$("input#options-values").val(JSON.stringify(e))}function checkAndSend(){checkCategories(),checkAgreeConditions(),checkOpenHours(),checkAddressGeolocalisation(),checkRequiredFields(),checkCaptcha(),$(".invalid").each(function(){$(this).closest(".input-field").addClass("error")}),$(".valid").each(function(){$(this).closest(".input-field").removeClass("error")});var e=$(".error:visible, .invalid:visible").length;0===e?(encodeOptionValuesIntoHiddenInput(),$("form").submit()):$("html,body").animate({scrollTop:$(".error:visible, .invalid:visible").first().offset().top-80},"slow")}function checkCaptcha(){var e=null;try{grecaptcha&&(e=!0)}catch(t){e=!1}console.log("checkCaptcha",e),e&&0===grecaptcha.getResponse().length?($("#captcha-error-message").addClass("error").show(),grecaptcha.reset()):$("#captcha-error-message").removeClass("error").hide()}function checkCategories(){$(".category-field:visible").each(function(){0===$(this).children(".option-field:visible").length?$(this).addClass("error"):$(this).removeClass("error")})}function checkAgreeConditions(){$("#agree").is(":checked")?($("#informations-title").removeClass("error"),$("#label-agree").removeClass("error"),$("#informations-title").text("Validation")):($("#informations-title").addClass("error"),$("#label-agree").addClass("error"),$("#informations-title").text("Vous devez vous engager pour continuer"))}function checkOpenHours(){$(".timepicker_1, .timepicker_3").each(function(){var e=$(this).attr("id"),t=e.split("-input-")[0]+"-input-"+(parseInt(e.split("-input-")[1])+1),i=$(this).val();""===i&&(i=null);var o=$("#"+t).val();""===o&&(o=null),i?($(this).parents(".open-hours-container").removeClass("open-day"),$(this).removeClass("invalid"),!o||o<=i?$("#"+t).addClass("invalid"):($("#"+t).removeClass("invalid"),$(this).parents(".open-hours-container").addClass("open-day"))):o&&$(this).addClass("invalid")})}function checkAddressGeolocalisation(){$("#input-latitude").val()||($("#input-address").addClass("invalid").focus(),$("#modal-title").text("Erreur"),$("#popup-content").text("Impossible de localiser cette adresse, veuillez la préciser"),$("#popup").openModal({dismissible:!0,opacity:.5,in_duration:300,out_duration:200}))}function checkRequiredFields(){$(".required").each(function(){$(this).val()?($(this).removeClass("invalid"),$(this).closest(".input-field").removeClass("error")):$(this).addClass("invalid")})}function getQueryParams(e){e=e.split("+").join(" ");for(var t,i={},o=/[?&]?([^=]+)=([^&]*)/g;t=o.exec(e);)i[decodeURIComponent(t[1])]=decodeURIComponent(t[2]);return i}function initAutoCompletionForElement(e){var t={componentRestrictions:{country:"fr"}},i=new google.maps.places.Autocomplete(e,t);google.maps.event.addListener(i,"place_changed",function(){return $(e).trigger("place_changed"),!1})}function checkLoginAndSend(){$(".required").each(function(){$(this).val()?($(this).removeClass("invalid"),$(this).closest(".input-field").removeClass("error")):$(this).addClass("invalid")}),$(".invalid").each(function(){$(this).closest(".input-field").addClass("error")}),$(".valid").each(function(){$(this).closest(".input-field").removeClass("error")}),0===$(".error:visible, .invalid:visible").length&&($("#inputMail").removeClass("invalid"),$("#inputMail").siblings("i").removeClass("invalid"),$('form[name="user"]').submit())}function geocodeAddress(e){return geocoding_processing?null:($("#geocode-spinner-loader").show(),geocoding_processing=!0,geocoder.geocode(e,function(e,t){null!==e&&e.length>0?(map.setView(e[0].getCoordinates(),15),createMarker(e[0].getCoordinates()),console.log("Geocode result :",e[0].postal_code),$("#input-latitude").val(marker.getLatLng().lat),$("#input-longitude").val(marker.getLatLng().lng),$("#input-postal-code").val(e[0].postal_code),$("#input-address").siblings("i").removeClass("error")):($("#input-address").addClass("invalid"),$("#input-address").siblings("i").addClass("error"),marker&&marker.remove(),$("#input-latitude").val(),$("#input-longitude").val(),$("#input-postal-code").val(),console.log("errur geocoding")),$("#geocode-spinner-loader").hide(),geocoding_processing=!1}),geocoding_ok)}function onloadCaptcha(){grecaptcha.render("captcha",{sitekey:"6Lc-HCUTAAAAANRcx2NKuISCo9psjeTdVsYFUcU8"})}function initMap(){var e;editMode&&$("#input-latitude").val()?(markerPosition=new L.LatLng($("#input-latitude").val(),$("#input-longitude").val()),e=markerPosition,mapZoom=16):(markerPosition=null,e=new L.LatLng(46.897045,2.425235),mapZoom=5),map=L.map("address-preview-map",{center:e,zoom:mapZoom,zoomControl:!1}),L.tileLayer("https://api.mapbox.com/styles/v1/mapbox/streets-v10/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1Ijoic2ViYWxsb3QiLCJhIjoiY2l4MGtneGVjMDF0aDJ6cWNtdWFvc2Y3YSJ9.nIZr6G2t08etMzft_BHHUQ").addTo(map),geocoder=GeocoderJS.createGeocoder("openstreetmap"),markerPosition&&createMarker(markerPosition)}function createMarker(e){marker&&marker.remove(),marker=new L.Marker(e,{draggable:!0}).addTo(map),marker.on("dragend",function(){$("#input-latitude").attr("value",marker.getLatLng().lat),$("#input-longitude").attr("value",marker.getLatLng().lng)}),marker.bindPopup("Déplacez moi pour préciser la position").openPopup()}function fitBounds(e){var t=L.latLng(e[0],e[1]),i=L.latLng(e[2],e[3]),o=L.latLngBounds(t,i);map.fitBounds(o)}function handleInputAdressChange(){geocodeAddress($("#input-address").val())}function addTimeSlot(e){$("#"+e+"-open-hours-second-line").addClass("active"),$("#"+e+"_ajout").css("visibility","hidden")}function clearTimeSlot(e){$("#"+e+"_ajout").css("visibility","visible"),$("#"+e+"-open-hours-second-line").removeClass("active"),$("#"+e+"-input-3").val(null),$("#"+e+"-input-4").val(null)}function redoTimeSlot(e){var t=e-1;$("#"+e+"-input-1").val($("#"+t+"-input-1").val()),$("#"+e+"-input-2").val($("#"+t+"-input-2").val()),$("#"+e+"-input-3").val($("#"+t+"-input-3").val()),$("#"+e+"-input-4").val($("#"+t+"-input-4").val()),($("#"+e+"-input-3").val()||$("#"+e+"-input-4").val())&&addTimeSlot(e)}function updateFormWithMainProduct(e){$(".checkbox-products.readonly").removeClass("readonly"),$("#biopen_elementbundle_element_listeProducts_"+e).prop("checked",!0).addClass("readonly").change()}function updateFormWithType(e){if("0"!=$("#element-type").val()){if(e=e!==!1,first_updateFormWithType_done)window.open("add?type="+$("#element-type").val(),"_self");else switch($("#element-type").val()>0&&($("#element-form-content").css("display","block"),$("#element-form-content").css("height",$("#element-form-content").get(0).scrollHeight),setTimeout(function(){$("#element-form-content").css("height","auto")},2e3),map.invalidateSize(!0)),$("#element-type").val()){case"1":$("#title-products").text("Produits disponibles"),$("#titre-open-hourss").text("Horaires de vente (optionnel)"),$("#is-part-of-element + label").text("Vous êtes ou travaillez chez ce producteur"),$("#input-address").attr("placeholder","Adresse du point de vente directe"),$("#other-selling-point").show(),$("#div-main-product").show();break;case"4":$("#titre-open-hourss").text("Horaires d'ouverture (optionnel)"),$("#title-products").text("Produits locaux et raisonnés présents dans la boutique"),$("#is-part-of-element + label").text("Vous travaillez dans cette boutique");break;case"3":$("#titre-open-hourss").text("Horaires de distribution (optionnel)"),$("#title-products").text("Produits présents dans cette AMAP"),$("#is-part-of-element + label").text("Vous faites partie de l'AMAP"),$("#label-agree").text("Vous vous engagez à fournir des informations exactes"),$("#optional-info-section, #optional-info-section + div.divider").hide(),$("#div-main-product").show();break;case"5":$("#titre-open-hourss").text("Horaires d'ouverture (optionnel)"),$("#section_products").css("display","none"),$(".checkbox-products:last-child").prop("checked",!0),$("#divider-products").hide(),$("#is-part-of-element + label").text("Vous travaillez dans cette boutique"),$("#autre").prop("checked",!0);break;case"2":$("#title-products").text("Produits locaux et raisonnés présents dans ce marché"),$("#is-part-of-element").parent().hide()}first_updateFormWithType_done=!0}}var index=1;jQuery(document).ready(function(){function e(e,t){var i=e.siblings(".category-field-select");console.log("select",i.attr("data-picking-text"));var o=i.find("input.select-dropdown");e.siblings(".option-field:visible").length+t===0?o.val("Choississez "+i.attr("data-picking-text")):o.val("Ajoutez "+i.attr("data-picking-text"))}$(".category-select").material_select(),$(".category-select").change(function(){if($(this).val()){$(this).parents(".category-field").removeClass("error");var t=$("#option-field-"+$(this).val());t.stop(!0,!1).slideDown({duration:350,easing:"easeOutQuart",queue:!1,complete:function(){$(this).css("height","")}}),t.attr("data-index",index),t.css("-webkit-box-ordinal-group",index),t.css("-moz-box-ordinal-group",index),t.css("-ms-flex-order",index),t.css("-webkit-order",index),t.css("order",index),e(t,1),index++}}),$(".option-field-delete").click(function(){var t=$("#option-field-"+$(this).attr("data-id"));t.hasClass("inline")?t.hide():t.stop(!0,!1).slideUp({duration:350,easing:"easeOutQuart",queue:!1,complete:function(){$(this).css("height","")}}),e(t,0)})}),jQuery(document).ready(function(){$("#btn-menu-directory").click(function(){window.location.href=Routing.generate("biopen_directory_normal")})}),jQuery(document).ready(function(){$("#btn-login").on("login",function(){window.location.reload()}),$("#btn-login").on("logout",function(){window.location.reload()})});var geocoding_processing=!1,map,geocoder,marker,geocoding_ok;jQuery(document).ready(function(){$(".timepicker_1").timepicki({start_time:["9","00"],increase_direction:"up",show_meridian:!1,step_size_minutes:15,min_hour_value:5,max_hour_value:23,overflow_minutes:!0}),$(".timepicker_2").timepicki({start_time:["12","00"],increase_direction:"up",show_meridian:!1,step_size_minutes:15,min_hour_value:5,max_hour_value:23,overflow_minutes:!0}),$(".timepicker_3").timepicki({start_time:["14","00"],increase_direction:"up",show_meridian:!1,step_size_minutes:15,min_hour_value:5,max_hour_value:23,overflow_minutes:!0}),$(".timepicker_4").timepicki({start_time:["18","00"],increase_direction:"up",show_meridian:!1,step_size_minutes:15,min_hour_value:5,max_hour_value:23,overflow_minutes:!0}),$("#element-type").val()>0&&(updateFormWithType(!1),updateFormWithMainProduct($("#main-product-selection").val()));var e=getQueryParams(document.location.search);e.type&&($('#element-type > option[value="'+e.type+'"]').prop("selected",!0),updateFormWithType(!1)),$(".tooltipped").tooltip(),$("#element-type").change(updateFormWithType),$("#main-product-selection").change(function(){updateFormWithMainProduct($(this).val())}),$("#input-address").change(function(){handleInputAdressChange()}),$("#input-address").keyup(function(e){13==e.keyCode&&handleInputAdressChange()}),$(".btn-geolocalize").click(function(){handleInputAdressChange()}),$("#search-bar").on("place_changed",handleInputAdressChange),$(".checkbox-products").click(function(){return!$(this).hasClass("readonly")}),$(".checkbox-products").change(function(){$(this).is(":checked")?$("#div_precision_"+$(this).attr("value")).css("display","block"):$("#div_precision_"+$(this).attr("value")).css("display","none")}),$(".add-time-slot-button").click(function(){addTimeSlot($(this).attr("id").split("_")[0])}),$(".clear-time-slot-button").click(function(){clearTimeSlot($(this).attr("id").split("_")[0])}),$(".redo-time-slot-button").click(function(){redoTimeSlot($(this).attr("id").split("_")[0])})});var first_updateFormWithType_done=!1;