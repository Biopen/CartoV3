{% extends "::bundle_layout.html.twig" %}

{% block title %}Constellation{% endblock %}

{# Stylessheets #}
{% block stylesheets %}

  <link rel="stylesheet" href="{{ asset('assets/img/icon/styles.css') }}">
  {# <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons"> #}
  <link rel="stylesheet" href="{{ asset('assets/css/constellation.css') }}">
  

{% endblock %}



{# BODY CONTENT #}
{% block body_content %}

<div id="div_map_and_products">

  {% if constellationPhp is defined %}
    {# La liste des products #}
    <section id="ProductsList" class="customScrollBar">   
      {% include '::Core/section-products-constellation.html.twig' %}      
    </section>
  {% else %}
      <div id="div_recherche_contener" class="valign-wrapper">
      <div id="div_recherche">
        {% for flash_message in app.session.flashbag.get('error') %}
            <div class="flash-error">
                {{ flash_message | raw }}
            </div>
        {% endfor %}
        {% include '::Components/inputAddress.html.twig'  %} 
      </div> 
  </div>  
  {% endif %}

   
  {# La Carte et les infos provider #} 
  <section id="section_carte">
    
    {#  PRELOADER #}
    {% include '::Components/loader.html.twig'  %}  

    <div id="map"></div>    

    <div id="bandeau_helper">Pour chaque produit, le plus proche fournisseur est affiché. Plus de résultats sont accessibles depuis le menu de gauche<span id="btn-bandeau-helper-close" class='icon-close'></span></div>

    <section id="bandeau_detail" class="customScrollBar" style="display:none">
      <div class="starRepresentationChoice-helper">
        <button class="btn btn-select-as-representant waves-effect waves-light">Sélectionner</button> en tant que "<span class='SRC-helper-starName'></span>" principal 
        
      </div> 
      <div id="detail_provider"></div>
      {% include '::Components/menu-provider.html.twig'  %}
    </section>

    <div id="btn_menu"><i class='icon-menu'></i></div> 
    <div id="overlay"></div>
    
  </section>  

</div>

{# Le bandeau qui indique qu'il y a une liste de résultat en bas #}
<div id="bandeau_goToProviderList">  
  <a href='#ProviderList'>
      <i class="icon-expand"></i>
      <span class="">Résultats sous forme de liste</span>
      <i class="icon-expand"></i>
  </a>
</div>

{# Les résultats par liste #}
<section id="ProviderList">  
  <ul class="collapsible popout customScrollBar" data-collapsible="accordion">
    <div class="provider-list-title" id="title-places">Les emplacements<div class='shadow-bottom'></div></div>
    <div id="places-end-container"></div> 
    <div class="provider-list-title" id="title-producteurAmap" >Les producteurs & Amaps<div class='shadow-bottom'></div></div> 
    <div id="producteurAmap-end-container"></div> 
  </ul>

  </ul>
</section>

{% endblock %}

{% block javascripts %}

  <script>

    var iconDirectory = "{{ asset('assets/img/icon/') }}"

    var providerList = null;
    {% if providerList is defined %}
      providerListJson = {{ providerList | serialize("json") | raw }};
    {% endif %}

    var onlyInputAdressMode = false;
    var constellationRawJson = null;
    {% if constellationPhp is defined %}
      constellationRawJson = {{ constellationPhp | serialize("json") | raw }};
    {% else %}
      onlyInputAdressMode = true;
    {% endif %} 

    var constellationMode = true;
  </script>

  <script src="{{ asset('bundles/fosjsrouting/js/router.js') }}"></script>
  <script src="{{ path('fos_js_routing_js', {'callback': 'fos.Router.setData'}) }}"></script>
  
  <script src="{{ asset('js/libs.min.js') }}"></script>  
  <script src="{{ asset('js/main.js') }}"></script>
  {# {% javascripts filter="?jsqueeze"
        "assets/js/libs/jquery-2.2.1.min.js"  
        "assets/js/libs/jquery-ui.min.js"        
        "assets/js/libs/cluster/cluster-commons.js"
        "assets/js/libs/cluster/clustericon.js"
        "assets/js/libs/cluster/cluster.js"
        "assets/js/libs/rich-marker.js"
        "assets/js/libs/cluster/markerclusterer.js" 
        "assets/js/libs/materialize/bin/materialize.js"
        "assets/js/components/inputAddress.js" 
        "assets/js/commons.js" 
        "assets/js/libs/twig.js"
        "assets/js/constellation/*"
        "assets/js/constelisting/*"
                
    %}
        <script src="{{ asset_url }}"></script>
    {% endjavascripts %} #}

    {% javascripts filter="twig_js" 
    '../app/Resources/views/Core/provider.html.twig'    
    %}
      <script type="text/javascript" src="{{ asset_url }}"></script>
    {% endjavascripts %}

     <script 
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBgah9u8A21CdN6O_fN80Op-4zcLJ0EwXk&libraries=places&callback=initMap">
  </script>

{% endblock %}

{% block modals %} 

  <!-- Pop up message alerte-->
  <div id="popup" class="modal">
  <div class="modal-content">
    <h5 id="popup_title"></h5>
    <p id="popup_content"></p>
  </div>
  <div class="modal-footer">
    <span class="modal-action modal-close waves-effect waves-teal btn-flat">OK</span>
  </div>
  </div>

{% endblock %}

